(function(n){function r(n,t,r){var u="("+r.replace(i,"\\$1")+")";return n.replace(new RegExp(u,"gi"),"<strong>$1<\/strong>")}function t(t,i){this.el=n(t);this.el.attr("autocomplete","off");this.suggestions=[];this.data=[];this.badQueries=[];this.selectedIndex=-1;this.currentValue=this.el.val();this.intervalId=0;this.cachedResponse=[];this.onChangeInterval=null;this.ignoreValueChange=!1;this.serviceUrl=i.serviceUrl;this.isLocal=!1;this.options={autoSubmit:!1,minChars:1,maxHeight:300,deferRequestBy:0,width:0,highlight:!0,params:{},fnFormatResult:r,delimiter:null,zIndex:9999};this.initialize();this.setOptions(i)}var i=new RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");n.fn.autocomplete=function(i){return new t(this.get(0)||n("<input />"),i)};t.prototype={killerFn:null,initialize:function(){var t,i,r;t=this;i=Math.floor(Math.random()*1048576).toString(16);r="Autocomplete_"+i;this.killerFn=function(i){n(i.target).parents(".autocomplete").size()===0&&(t.killSuggestions(),t.disableKillerFn())};this.options.width||(this.options.width=this.el.width());this.mainContainerId="AutocompleteContainter_"+i;n('<div id="'+this.mainContainerId+'" style="position:absolute;z-index:9999;"><div class="autocomplete-w1"><div class="autocomplete" id="'+r+'" style="display:none; width:300px;"><\/div><\/div><\/div>').appendTo("body");this.container=n("#"+r);this.fixPosition();window.opera?this.el.keypress(function(n){t.onKeyPress(n)}):this.el.keydown(function(n){t.onKeyPress(n)});this.el.keyup(function(n){t.onKeyUp(n)});this.el.blur(function(){t.enableKillerFn()});this.el.focus(function(){t.fixPosition()});n(window).scroll(function(){t.fixPosition()})},setOptions:function(t){var i=this.options;n.extend(i,t);i.lookup&&(this.isLocal=!0,n.isArray(i.lookup)&&(i.lookup={suggestions:i.lookup,data:[]}));n("#"+this.mainContainerId).css({zIndex:i.zIndex});this.container.css({maxHeight:i.maxHeight+"px",width:i.width})},clearCache:function(){this.cachedResponse=[];this.badQueries=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var t=this.el.offset();n("#"+this.mainContainerId).css({top:t.top+this.el.innerHeight()+"px",left:t.left+"px"})},enableKillerFn:function(){var t=this;n(document).bind("click",t.killerFn)},disableKillerFn:function(){var t=this;n(document).unbind("click",t.killerFn)},killSuggestions:function(){var n=this;this.stopKillSuggestions();this.intervalId=window.setInterval(function(){n.hide();n.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(n){if(!this.disabled&&this.enabled){switch(n.keyCode){case 27:this.el.val(this.currentValue);this.hide();break;case 9:case 13:if(this.selectedIndex===-1){this.hide();return}if(this.select(this.selectedIndex),n.keyCode===9)return;break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return}n.stopImmediatePropagation();n.preventDefault()}},onKeyUp:function(n){if(!this.disabled){switch(n.keyCode){case 38:case 40:return}if(clearInterval(this.onChangeInterval),this.currentValue!==this.el.val())if(this.options.deferRequestBy>0){var t=this;this.onChangeInterval=setInterval(function(){t.onValueChange()},this.options.deferRequestBy)}else this.onValueChange()}},onValueChange:function(){clearInterval(this.onChangeInterval);this.currentValue=this.el.val();var n=this.getQuery(this.currentValue);if(this.selectedIndex=-1,this.ignoreValueChange){this.ignoreValueChange=!1;return}n===""||n.length<this.options.minChars?this.hide():this.getSuggestions(n)},getQuery:function(t){var i,r;return(i=this.options.delimiter,!i)?n.trim(t):(r=t.split(i),n.trim(r[r.length-1]))},getSuggestionsLocal:function(n){var i,r,f,u,t;for(r=this.options.lookup,f=r.suggestions.length,i={suggestions:[],data:[]},n=n.toLowerCase(),t=0;t<f;t++)u=r.suggestions[t],u.toLowerCase().indexOf(n)===0&&(i.suggestions.push(u),i.data.push(r.data[t]));return i},getSuggestions:function(t){var i,r;i=this.isLocal?this.getSuggestionsLocal(t):this.cachedResponse[t];i&&n.isArray(i.suggestions)?(this.suggestions=i.suggestions,this.data=i.data,this.suggest()):this.isBadQuery(t)||(r=this,r.options.params.query=t,n.get(this.serviceUrl,r.options.params,function(n){r.processResponse(n)},"text"))},isBadQuery:function(n){for(var t=this.badQueries.length;t--;)if(n.indexOf(this.badQueries[t])===0)return!0;return!1},hide:function(){this.enabled=!1;this.selectedIndex=-1;this.container.hide()},suggest:function(){if(this.suggestions.length===0){this.hide();return}var i,f,r,e,o,t,u,s,h;for(i=this,f=this.suggestions.length,e=this.options.fnFormatResult,o=this.getQuery(this.currentValue),s=function(n){return function(){i.activate(n)}},h=function(n){return function(){i.select(n)}},this.container.hide().empty(),t=0;t<f;t++)u=this.suggestions[t],r=n((i.selectedIndex===t?'<div class="selected"':"<div")+' title="'+u+'">'+e(u,this.data[t],o)+"<\/div>"),r.mouseover(s(t)),r.click(h(t)),this.container.append(r);this.enabled=!0;this.container.show()},processResponse:function(t){var i;try{i=eval("("+t+")")}catch(r){return}n.isArray(i.data)||(i.data=[]);this.options.noCache||(this.cachedResponse[i.query]=i,i.suggestions.length===0&&this.badQueries.push(i.query));i.query===this.getQuery(this.currentValue)&&(this.suggestions=i.suggestions,this.data=i.data,this.suggest())},activate:function(t){var i,r;return i=this.container.children(),this.selectedIndex!==-1&&i.length>this.selectedIndex&&n(i.get(this.selectedIndex)).removeClass(),this.selectedIndex=t,this.selectedIndex!==-1&&i.length>this.selectedIndex&&(r=i.get(this.selectedIndex),n(r).addClass("selected")),r},deactivate:function(n,t){n.className="";this.selectedIndex===t&&(this.selectedIndex=-1)},select:function(n){var t,i;if(t=this.suggestions[n],t){this.el.val(t);this.options.autoSubmit&&(i=this.el.parents("form"),i.length>0&&i.get(0).submit());this.ignoreValueChange=!0;this.hide();this.onSelect(n)}},moveUp:function(){if(this.selectedIndex!==-1){if(this.selectedIndex===0){this.container.children().get(0).className="";this.selectedIndex=-1;this.el.val(this.currentValue);return}this.adjustScroll(this.selectedIndex-1)}},moveDown:function(){this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(n){var r,t,i,u;r=this.activate(n);t=r.offsetTop;i=this.container.scrollTop();u=i+this.options.maxHeight-25;t<i?this.container.scrollTop(t):t>u&&this.container.scrollTop(t-this.options.maxHeight+25);this.el.val(this.getValue(this.suggestions[n]))},onSelect:function(t){var i,r,u,f;i=this;r=i.options.onSelect;u=i.suggestions[t];f=i.data[t];i.el.val(i.getValue(u));n.isFunction(r)&&r(u,f,i.el)},getValue:function(n){var r,t,i,u;return(u=this,r=u.options.delimiter,!r)?n:(t=u.currentValue,i=t.split(r),i.length===1)?n:t.substr(0,t.length-i[i.length-1].length)+n}}})(jQuery);